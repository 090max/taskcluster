{
  "version": "0.2.0",
  "title": "Scheduler AMQP Exchanges",
  "description": "The scheduler, typically available at `scheduler.taskcluster.net` is\nresponsible for accepting task-graphs and schedule tasks on the queue as\ntheir dependencies are completed successfully.\n\nThis document describes the AMQP exchanges offered by the scheduler,\nwhich allows third-party listeners to monitor task-graph submission and\nresolution. These exchanges targets the following audience:\n * Reporters, who displays the state of task-graphs or emails people on\n   failures, and\n * End-users, who wants notification of completed task-graphs\n\n**Remark**, the task-graph scheduler will require that the `schedulerId`\nfor tasks is set to the `schedulerId` for the task-graph scheduler. In\nproduction the `schedulerId` is typically `\"task-graph-scheduler\"`.\nFurthermore, the task-graph scheduler will also require that\n`taskGroupId` is equal to the `taskGraphId`.\n\nCombined these requirements ensures that `schedulerId` and `taskGroupId`\nhave the same position in the routing keys for the queue exchanges.\nSee queue documentation for details on queue exchanges. Hence, making\nit easy to listen for all tasks in a given task-graph.\n\nNote that routing key entries 2 through 7 used for exchanges on the\ntask-graph scheduler is hardcoded to `_`. This is done to preserve\npositional equivalence with exchanges offered by the queue.",
  "exchangePrefix": "exchange/taskcluster-scheduler/v1/",
  "entries": [
    {
      "type": "topic-exchange",
      "exchange": "task-graph-running",
      "name": "taskGraphRunning",
      "title": "Task-Graph Running Message",
      "description": "When a task-graph is submitted it immediately starts running and a\nmessage is posted on this exchange to indicate that a task-graph have\nbeen submitted.",
      "routingKey": [
        {
          "name": "routingKeyKind",
          "summary": "Identifier for the routing-key kind. This is always `'primary'` for the formalized routing key.",
          "constant": "primary",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "runId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerGroup",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "provisionerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerType",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "schedulerId",
          "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskGraphId",
          "summary": "Identifier for the task-graph this message concerns",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "reserved",
          "summary": "Space reserved for future routing-key entries, you should always match this entry with `#`. As automatically done by our tooling, if not specified.",
          "multipleWords": true,
          "required": false
        }
      ],
      "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-running-message.json#"
    },
    {
      "type": "topic-exchange",
      "exchange": "task-graph-extended",
      "name": "taskGraphExtended",
      "title": "Task-Graph Extended Message",
      "description": "When a task-graph is extended, that is additional tasks is added to the\ntask-graph, a message is posted on this exchange. This is useful if you\nare monitoring a task-graph and what to track states of the individual\ntasks in the task-graph.",
      "routingKey": [
        {
          "name": "routingKeyKind",
          "summary": "Identifier for the routing-key kind. This is always `'primary'` for the formalized routing key.",
          "constant": "primary",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "runId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerGroup",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "provisionerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerType",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "schedulerId",
          "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskGraphId",
          "summary": "Identifier for the task-graph this message concerns",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "reserved",
          "summary": "Space reserved for future routing-key entries, you should always match this entry with `#`. As automatically done by our tooling, if not specified.",
          "multipleWords": true,
          "required": false
        }
      ],
      "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-extended-message.json#"
    },
    {
      "type": "topic-exchange",
      "exchange": "task-graph-blocked",
      "name": "taskGraphBlocked",
      "title": "Task-Graph Blocked Message",
      "description": "When a task is completed unsuccessfully and all reruns have been\nattempted, the task-graph will not complete successfully and it's\ndeclared to be _blocked_, by some task that consistently completes\nunsuccessfully.\n\nWhen a task-graph becomes blocked a messages is posted to this exchange.\nThe message features the `taskId` of the task that caused the task-graph\nto become blocked.",
      "routingKey": [
        {
          "name": "routingKeyKind",
          "summary": "Identifier for the routing-key kind. This is always `'primary'` for the formalized routing key.",
          "constant": "primary",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "runId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerGroup",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "provisionerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerType",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "schedulerId",
          "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskGraphId",
          "summary": "Identifier for the task-graph this message concerns",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "reserved",
          "summary": "Space reserved for future routing-key entries, you should always match this entry with `#`. As automatically done by our tooling, if not specified.",
          "multipleWords": true,
          "required": false
        }
      ],
      "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-blocked-message.json#"
    },
    {
      "type": "topic-exchange",
      "exchange": "task-graph-finished",
      "name": "taskGraphFinished",
      "title": "Task-Graph Finished Message",
      "description": "When all tasks of a task-graph have completed successfully, the\ntask-graph is declared to be finished, and a message is posted to this\nexchange.",
      "routingKey": [
        {
          "name": "routingKeyKind",
          "summary": "Identifier for the routing-key kind. This is always `'primary'` for the formalized routing key.",
          "constant": "primary",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "runId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerGroup",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "provisionerId",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "workerType",
          "summary": "Always takes the value `_`",
          "multipleWords": false,
          "required": false
        },
        {
          "name": "schedulerId",
          "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "taskGraphId",
          "summary": "Identifier for the task-graph this message concerns",
          "multipleWords": false,
          "required": true
        },
        {
          "name": "reserved",
          "summary": "Space reserved for future routing-key entries, you should always match this entry with `#`. As automatically done by our tooling, if not specified.",
          "multipleWords": true,
          "required": false
        }
      ],
      "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-finished-message.json#"
    }
  ]
}