language: go
sudo: false
go:
- 1.4
before_install:
- go get github.com/axw/gocov/gocov
- go get github.com/mattn/goveralls
- go get golang.org/x/tools/cmd/cover
- go get golang.org/x/tools/cmd/vet
- go get github.com/pierrre/gotestcover
script:
# since gotestcover can have 0 exit code even with failures, run tests with go
# test, and only run again with coverage in `after_script` section
- go test -v ./...
after_script:
- "${GOPATH}/bin/gotestcover -v -coverprofile=coverage.report ./..."
- go tool cover -func=coverage.report
- "${HOME}/gopath/bin/goveralls -coverprofile=coverage.report -service=travis-ci"
notifications:
  irc:
    channels:
    # encrpyt channel name to get around issue
    # https://github.com/travis-ci/travis-ci/issues/1094
    # encrpyted string was "irc.mozilla.org#taskcluster-bots"
    - secure: "aYfRwI+g4L9xkUXXKWFx7TuR4TojGVjnUWEx74TvrrAeNqJd1+9vZdtohncQxvArpx0gRHVfVc6n2AZoBNUgo2dSqTBWVwtUQfGf0JyQddS6MdTJzHS2aoNgGRWUwRznjZzloD0eZZfeW+/nbYsfSS12Edl3YNT4X8/rhlHVtO4="
    on_success: always
    on_failure: always
    template:
    - "%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{message}"
    - "Change view : %{compare_url}"
    - "Build details : %{build_url}"
    - "Commit message : %{commit_message}"
